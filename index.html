<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPK - Sistem Pemetaan Konsumsi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f9; font-size: 0.85rem; color: #334155; }
        .header-box { background: #1e293b; color: white; border-radius: 8px; margin-bottom: 20px; padding: 15px; }
        .card { border: none; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        label { font-weight: bold; font-size: 0.75rem; margin-top: 10px; display: block; }
        .form-control-sm { border-radius: 6px; border: 1px solid #cbd5e1; padding: 8px; }
        .btn-primary { background: #1e293b; border: none; font-weight: bold; padding: 10px; }
        .badge-step { font-size: 0.7rem; padding: 4px 8px; border-radius: 20px; }
    </style>
</head>
<body class="p-2 p-md-4">

<div class="container-fluid">
    <div class="header-box text-center shadow-sm">
        <h4 class="fw-bold mb-0">SISTEM PEMETAAN KEGIATAN (SPK)</h4>
        <small class="opacity-75">BAGIAN KONSUMSI - PANJIMAS 2026</small>
    </div>

    <div class="row g-4">
        <div class="col-lg-4">
            <div class="card p-3">
                <h6 class="fw-bold border-bottom pb-2">FORM PERENCANAAN</h6>
                <form id="formInput">
                    <label>Tahapan (Before/During/After)</label>
                    <select id="tahapan" class="form-control form-control-sm" required>
                        <option value="Before">Before (Persiapan)</option>
                        <option value="During">During (Pelaksanaan)</option>
                        <option value="After">After (Evaluasi)</option>
                    </select>

                    <label>Nama Kegiatan</label>
                    <input type="text" id="namaKegiatan" class="form-control form-control-sm" required>

                    <label>Jenis Kegiatan</label>
                    <select id="jenisKegiatan" class="form-control form-control-sm" required>
                        <option value="Rapat/Kumpul">Rapat / Kumpul</option>
                        <option value="Penyambutan Tamu / Pengarahan Walsan">Penyambutan Tamu / Pengarahan Walsan</option>
                        <option value="Ujian">Ujian</option>
                        <option value="Sidang">Sidang</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>

                    <div class="row g-2">
                        <div class="col-6"><label>Tanggal</label><input type="date" id="tanggal" class="form-control form-control-sm" required></div>
                        <div class="col-6"><label>Waktu</label><input type="time" id="waktu" class="form-control form-control-sm" required></div>
                    </div>

                    <label>Tempat Kegiatan</label>
                    <input type="text" id="tempat" class="form-control form-control-sm" placeholder="Contoh: Aula / Kelas" required>

                    <label>Jumlah Peserta (Orang)</label>
                    <input type="number" id="peserta" class="form-control form-control-sm" value="0">

                    <label>Kehadiran Pimpinan</label>
                    <select id="pimpinan" class="form-control form-control-sm">
                        <option value="Hadir">Hadir</option>
                        <option value="Tidak">Tidak Hadir</option>
                    </select>

                    <label>Jumlah Guru Senior (Orang)</label>
                    <input type="number" id="guruSenior" class="form-control form-control-sm" value="0">

                    <div class="bg-light p-2 mt-3 rounded border">
                        <label class="mt-0 text-primary">DETAIL KONSUMSI</label>
                        <input type="text" id="kBrat" class="form-control form-control-sm mb-2" placeholder="Nasi Box/Prasmanan">
                        <input type="text" id="kRingan" class="form-control form-control-sm mb-2" placeholder="Snack Box">
                        <input type="text" id="kMix" class="form-control form-control-sm" placeholder="Mix Berat & Ringan">
                    </div>

                    <label>Kebutuhan Alat</label>
                    <input type="text" id="alat" class="form-control form-control-sm">

                    <label>Keterangan Tambahan</label>
                    <textarea id="ket" class="form-control form-control-sm" rows="2"></textarea>

                    <button type="submit" id="btn" class="btn btn-primary w-100 mt-3 shadow-sm">SIMPAN RENCANA</button>
                </form>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="card overflow-hidden">
                <div class="bg-dark p-2 text-white text-center small fw-bold text-uppercase">Daftar Pemetaan Kegiatan</div>
                <div class="table-responsive">
                    <table class="table table-sm table-hover mb-0" style="font-size: 0.75rem;">
                        <thead class="table-light">
                            <tr>
                                <th class="ps-3">No</th>
                                <th>Tahap / Jenis</th>
                                <th>Kegiatan / Lokasi</th>
                                <th>Peserta</th>
                                <th>Konsumsi</th>
                                <th>Alat & Ket</th>
                            </tr>
                        </thead>
                        <tbody id="rekap">
                            <tr><td colspan="6" class="text-center py-5">Memuat database...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // GANTI DENGAN URL WEB APP BARU ANDA
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzN0IeTC4qjoBTtjOafc7c3YeB1fQAQpIEdwke9uuACpo5E0_IaFrjvJqHe2YO93QxM/exec";

    function loadData() {
        fetch(SCRIPT_URL).then(r => r.json()).then(d => {
            let h = "";
            for(let i=1; i<d.length; i++) {
                h += `<tr>
                    <td class="ps-3">${i}</td>
                    <td><span class="badge badge-step ${d[i][1]=='Before'?'bg-info':'bg-success'}">${d[i][1]}</span><br><small>${d[i][3]}</small></td>
                    <td><strong>${d[i][2]}</strong><br><small>${d[i][4]} | ${d[i][5]} | ${d[i][6]}</small></td>
                    <td>P: ${d[i][7]}<br>Pim: ${d[i][8]}<br>Sr: ${d[i][9]}</td>
                    <td>
                        <small>${d[i][10] ? 'B: '+d[i][10] : ''}</small><br>
                        <small>${d[i][11] ? 'R: '+d[i][11] : ''}</small><br>
                        <small>${d[i][12] ? 'M: '+d[i][12] : ''}</small>
                    </td>
                    <td><small><b>Alat:</b> ${d[i][13] || '-'}</small><br><small><b>Ket:</b> ${d[i][14] || '-'}</small></td>
                </tr>`;
            }
            document.getElementById('rekap').innerHTML = h;
        });
    }

    document.getElementById('formInput').onsubmit = function(e) {
        e.preventDefault();
        document.getElementById('btn').disabled = true;
        document.getElementById('btn').innerText = "MENYIMPAN...";

        const payload = {
            tahapan: document.getElementById('tahapan').value,
            namaKegiatan: document.getElementById('namaKegiatan').value,
            jenisKegiatan: document.getElementById('jenisKegiatan').value,
            tanggal: document.getElementById('tanggal').value,
            waktu: document.getElementById('waktu').value,
            tempat: document.getElementById('tempat').value,
            peserta: document.getElementById('peserta').value,
            pimpinan: document.getElementById('pimpinan').value,
            guruSenior: document.getElementById('guruSenior').value,
            konsumsiBerat: document.getElementById('kBrat').value,
            konsumsiRingan: document.getElementById('kRingan').value,
            konsumsiMix: document.getElementById('kMix').value,
            kebutuhan: document.getElementById('alat').value,
            keterangan: document.getElementById('ket').value
        };

        fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) })
        .then(() => {
            alert("Berhasil!");
            location.reload();
        });
    };
    loadData();
</script>
</body>
</html>
