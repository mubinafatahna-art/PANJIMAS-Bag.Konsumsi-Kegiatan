<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMS - Pemetaan Konsumsi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-size: 0.85rem; }
        .header-box { background: #2c3e50; color: white; border-radius: 10px; margin-bottom: 20px; }
        .card { border: none; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .btn-primary { background: #2c3e50; border: none; }
        label { font-weight: bold; font-size: 0.75rem; color: #444; margin-top: 8px; }
    </style>
</head>
<body class="p-2 p-md-4">

<div class="container-fluid">
    <div class="header-box p-3 text-center">
        <h4 class="fw-bold mb-0">BMS</h4>
        <small>PEMETAAN KEGIATAN KONSUMSI PANJIMAS 2026</small>
    </div>

    <div class="row g-3">
        <div class="col-lg-4">
            <div class="card p-3">
                <form id="formPemetaan">
                    <label>Tahapan (Before/During/After)</label>
                    <select id="tahapan" class="form-control form-control-sm" required>
                        <option value="Before">Before</option>
                        <option value="During">During</option>
                        <option value="After">After</option>
                    </select>

                    <label>Nama Kegiatan</label>
                    <input type="text" id="namaKegiatan" class="form-control form-control-sm" required>

                    <label>Tanggal & Waktu</label>
                    <div class="d-flex gap-2">
                        <input type="date" id="tanggal" class="form-control form-control-sm" required>
                        <input type="time" id="waktu" class="form-control form-control-sm" required>
                    </div>

                    <label>Peserta | Pimpinan | Guru Sr</label>
                    <div class="d-flex gap-2">
                        <input type="number" id="peserta" class="form-control form-control-sm" placeholder="Peserta" required>
                        <select id="pimpinan" class="form-control form-control-sm">
                            <option value="Hadir">Hadir</option>
                            <option value="Tidak">Tidak</option>
                        </select>
                        <input type="number" id="guruSenior" class="form-control form-control-sm" placeholder="Guru">
                    </div>

                    <div class="bg-light p-2 mt-3 rounded border">
                        <label class="text-primary mt-0">DETAIL KONSUMSI</label>
                        <input type="text" id="kBrat" class="form-control form-control-sm mb-2" placeholder="Konsumsi Berat (Nasi)">
                        <input type="text" id="kRingan" class="form-control form-control-sm mb-2" placeholder="Konsumsi Ringan (Snack)">
                        <input type="text" id="kMix" class="form-control form-control-sm" placeholder="Konsumsi Berat & Ringan">
                    </div>

                    <label>Kebutuhan Alat & Keterangan</label>
                    <input type="text" id="kebutuhan" class="form-control form-control-sm mb-2" placeholder="Alat: Piring, dll">
                    <textarea id="keterangan" class="form-control form-control-sm" rows="2"></textarea>

                    <button type="submit" id="btn" class="btn btn-primary w-100 mt-3 btn-sm fw-bold">SIMPAN RENCANA</button>
                </form>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="card overflow-hidden">
                <div class="bg-dark p-2 text-white text-center small fw-bold">DAFTAR PEMETAAN KEGIATAN</div>
                <div class="table-responsive">
                    <table class="table table-sm table-hover align-middle mb-0" style="font-size: 0.75rem;">
                        <thead class="table-light">
                            <tr>
                                <th>No</th>
                                <th>Tahap</th>
                                <th>Kegiatan</th>
                                <th>Peserta</th>
                                <th>Detail Konsumsi</th>
                                <th>Alat/Ket</th>
                            </tr>
                        </thead>
                        <tbody id="rekap">
                            <tr><td colspan="6" class="text-center py-4">Memuat data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyzS40nJM6pW3O2ADOSrt7wR1aJtVfu-xuvvAP9GGZ4Jm-HpgsReph3Q1oQqz1renN1/exec";

    function load() {
        fetch(SCRIPT_URL).then(r => r.json()).then(d => {
            let h = "";
            for(let i=1; i<d.length; i++) {
                h += `<tr>
                    <td>${i}</td>
                    <td><span class="badge ${d[i][1]=='Before'?'bg-info':'bg-success'}">${d[i][1]}</span></td>
                    <td><b>${d[i][2]}</b><br><small>${d[i][4]} | ${d[i][5]}</small></td>
                    <td>${d[i][7]} Org<br><small>Pim: ${d[i][8]}</small></td>
                    <td>
                        ${d[i][10] ? 'B: '+d[i][10]+'<br>' : ''}
                        ${d[i][11] ? 'R: '+d[i][11]+'<br>' : ''}
                        ${d[i][12] ? 'Mix: '+d[i][12] : ''}
                    </td>
                    <td><small>${d[i][13] || '-'}<br>${d[i][14] || '-'}</small></td>
                </tr>`;
            }
            document.getElementById('rekap').innerHTML = h;
        });
    }

    document.getElementById('formPemetaan').onsubmit = function(e) {
        e.preventDefault();
        document.getElementById('btn').innerText = "Menyimpan...";
        const data = {
            tahapan: document.getElementById('tahapan').value,
            namaKegiatan: document.getElementById('namaKegiatan').value,
            jenisKegiatan: "Kegiatan",
            tanggal: document.getElementById('tanggal').value,
            waktu: document.getElementById('waktu').value,
            tempat: "-", 
            peserta: document.getElementById('peserta').value,
            pimpinan: document.getElementById('pimpinan').value,
            guruSenior: document.getElementById('guruSenior').value,
            konsumsiBerat: document.getElementById('kBrat').value,
            konsumsiRingan: document.getElementById('kRingan').value,
            konsumsiMix: document.getElementById('kMix').value,
            kebutuhan: document.getElementById('kebutuhan').value,
            keterangan: document.getElementById('keterangan').value
        };
        fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) })
        .then(() => location.reload());
    };
    load();
</script>
</body>
</html>
