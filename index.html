<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pemetaan Konsumsi PANJIMAS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; font-size: 0.85rem; }
        .header-box { background: linear-gradient(45deg, #2c3e50, #000000); color: white; border-radius: 15px; }
        .form-card, .table-card { border: none; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn-submit { background: #2c3e50; color: white; border: none; padding: 10px; font-weight: bold; }
        label { font-weight: bold; font-size: 0.75rem; color: #555; margin-top: 8px; }
        .table thead { background-color: #2c3e50; color: white; font-size: 0.75rem; }
        @media (max-width: 768px) { .container { padding: 5px; } }
    </style>
</head>
<body class="py-3">

<div class="container-fluid">
    <div class="header-box p-3 text-center mb-4">
        <h3 class="fw-bold mb-0">SISTEM PEMETAAN KEGIATAN (SPK)</h3>
        <p class="mb-0 small">Pemetaan Kegiatan Konsumsi PANJIMAS 2026</p>
    </div>

    <div class="card form-card p-3 mb-4">
    <h6 class="fw-bold border-bottom pb-2">INPUT RENCANA KEGIATAN</h6>
    <form id="formPemetaan">
        <label class="mt-3 text-primary">DETAIL KONSUMSI</label>
        <div class="bg-light p-2 rounded">
            <label>Konsumsi Berat (Nasi/Prasmanan)</label>
            <input type="text" id="kBrat" class="form-control form-control-sm mb-2" placeholder="Contoh: Nasi Box Ayam">
            
            <label>Konsumsi Ringan (Snack/Kue)</label>
            <input type="text" id="kRingan" class="form-control form-control-sm mb-2" placeholder="Contoh: Roti + Lemper">
            
            <label>Konsumsi Berat & Ringan (Mix)</label>
            <input type="text" id="kMix" class="form-control form-control-sm" placeholder="Isi jika ada paket lengkap">
        </div>

        <label>Kebutuhan Alat</label>
        <input type="text" id="kebutuhan" class="form-control form-control-sm" placeholder="Piring, Gelas, dll">
        
        <label>Keterangan</label>
        <textarea id="keterangan" class="form-control form-control-sm" rows="2"></textarea>

        <button type="submit" id="btnKirim" class="btn btn-submit w-100 mt-3 btn-sm shadow">SIMPAN RENCANA</button>
    </form>
</div>

<script>
    function loadRekap() {
        fetch(SCRIPT_URL)
            .then(res => res.json())
            .then(data => {
                let html = "";
                if (data && data.length > 1) {
                    for(let i = 1; i < data.length; i++) {
                        // Menggabungkan tampilan konsumsi di tabel
                        let infoKonsumsi = `
                            <small><b>Berat:</b> ${data[i][10] || '-'}</small><br>
                            <small><b>Ringan:</b> ${data[i][11] || '-'}</small><br>
                            <small><b>Mix:</b> ${data[i][12] || '-'}</small>
                        `;

                        html += `<tr>
                            <td>${i}</td>
                            <td><span class="badge ${data[i][1] == 'Before' ? 'bg-info' : 'bg-success'}">${data[i][1]}</span></td>
                            <td><b>${data[i][2]}</b></td>
                            <td>${data[i][4]}<br><small>${data[i][5]}</small></td>
                            <td>${data[i][7]} <small>Org</small></td>
                            <td>${infoKonsumsi}</td>
                            <td><small>${data[i][14] || '-'}</small></td>
                        </tr>`;
                    }
                    document.getElementById('rekapTable').innerHTML = html;
                }
            });
    }

    document.getElementById('formPemetaan').onsubmit = function(e) {
        e.preventDefault();
        const data = {
            tahapan: document.getElementById('tahapan').value,
            namaKegiatan: document.getElementById('namaKegiatan').value,
            // ... (data lainnya)
            konsumsiBerat: document.getElementById('kBrat').value,
            konsumsiRingan: document.getElementById('kRingan').value,
            konsumsiMix: document.getElementById('kMix').value,
            kebutuhan: document.getElementById('kebutuhan').value,
            keterangan: document.getElementById('keterangan').value
        };
        // ... (proses fetch POST)
    };
</script>
    // GANTI DENGAN URL APPS SCRIPT SPREADSHEET PEMETAAN ANDA
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzul1maQJ7cVvg8iSvVsKwhA3RQETsDCN1c3N87g_s2fWHhT9dtPCkAamfVMNz1J2pw/exec"; 

    function loadRekap() {
        fetch(SCRIPT_URL)
            .then(res => res.json())
            .then(data => {
                let html = "";
                if (data && data.length > 1) {
                    for(let i = 1; i < data.length; i++) {
                        html += `<tr>
                            <td>${i}</td>
                            <td><span class="badge ${data[i][1] == 'Before' ? 'bg-info' : data[i][1] == 'During' ? 'bg-success' : 'bg-secondary'}">${data[i][1]}</span></td>
                            <td><b>${data[i][2]}</b><br><small class="text-muted">${data[i][3]} - ${data[i][6]}</small></td>
                            <td>${data[i][4]}<br><small>${data[i][5]}</small></td>
                            <td>${data[i][7]} <small>Orang</small></td>
                            <td>${data[i][10]}</td>
                            <td><small>${data[i][12] || '-'}</small></td>
                        </tr>`;
                    }
                    document.getElementById('rekapTable').innerHTML = html;
                } else {
                    document.getElementById('rekapTable').innerHTML = '<tr><td colspan="7" class="text-center">Belum ada rencana.</td></tr>';
                }
            });
    }

    document.getElementById('formPemetaan').onsubmit = function(e) {
        e.preventDefault();
        const btn = document.getElementById('btnKirim');
        btn.disabled = true;
        btn.innerText = "MENYIMPAN...";

        const data = {
            tahapan: document.getElementById('tahapan').value,
            namaKegiatan: document.getElementById('namaKegiatan').value,
            jenisKegiatan: document.getElementById('jenisKegiatan').value,
            tanggal: document.getElementById('tanggal').value,
            waktu: document.getElementById('waktu').value,
            tempat: document.getElementById('tempat').value,
            peserta: document.getElementById('peserta').value,
            pimpinan: document.getElementById('pimpinan').value,
            guruSenior: document.getElementById('guruSenior').value,
            jenisKonsumsi: document.getElementById('jenisKonsumsi').value,
            kebutuhan: "", // Kolom Kebutuhan digabung di UI
            keterangan: document.getElementById('keterangan').value
        };

        fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) })
        .then(() => {
            alert('Rencana Berhasil Disimpan!');
            location.reload();
        });
    };

    loadRekap();
</script>
</body>
</html>
