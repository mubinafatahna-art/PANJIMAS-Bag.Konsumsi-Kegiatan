<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pemetaan Konsumsi PANJIMAS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; font-size: 0.85rem; }
        .header-box { background: linear-gradient(45deg, #2c3e50, #000000); color: white; border-radius: 15px; }
        .form-card, .table-card { border: none; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn-submit { background: #2c3e50; color: white; border: none; padding: 10px; font-weight: bold; }
        label { font-weight: bold; font-size: 0.75rem; color: #555; margin-top: 8px; }
        .table thead { background-color: #2c3e50; color: white; font-size: 0.75rem; }
        @media (max-width: 768px) { .container { padding: 5px; } }
    </style>
</head>
<body class="py-3">

<div class="container-fluid">
    <div class="header-box p-3 text-center mb-4">
        <h3 class="fw-bold mb-0">SISTEM PEMETAAN KEGIATAN (SPK)</h3>
        <p class="mb-0 small">Pemetaan Kegiatan Konsumsi PANJIMAS 2026</p>
    </div>

    <div class="row g-3">
        <div class="col-lg-4">
            <div class="card form-card p-3">
                <h6 class="fw-bold border-bottom pb-2">INPUT RENCANA KEGIATAN</h6>
                <form id="formPemetaan">
                    <label>Tahapan</label>
                    <select id="tahapan" class="form-control form-control-sm" required>
                        <option value="" disabled selected>Pilih...</option>
                        <option value="Before">Before</option>
                        <option value="During">During</option>
                        <option value="After">After</option>
                    </select>

                    <label>Nama Kegiatan</label>
                    <input type="text" id="namaKegiatan" class="form-control form-control-sm" required>

                    <div class="row g-2">
                        <div class="col-6">
                            <label>Jenis</label>
                            <input type="text" id="jenisKegiatan" class="form-control form-control-sm" placeholder="Rapat/Ujian" required>
                        </div>
                        <div class="col-6">
                            <label>Tanggal</label>
                            <input type="date" id="tanggal" class="form-control form-control-sm" required>
                        </div>
                    </div>

                    <div class="row g-2">
                        <div class="col-6">
                            <label>Waktu</label>
                            <input type="time" id="waktu" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-6">
                            <label>Tempat</label>
                            <input type="text" id="tempat" class="form-control form-control-sm" required>
                        </div>
                    </div>

                    <div class="row g-2">
                        <div class="col-4">
                            <label>Peserta</label>
                            <input type="number" id="peserta" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-4">
                            <label>Pimpinan</label>
                            <select id="pimpinan" class="form-control form-control-sm">
                                <option value="Hadir">Hadir</option>
                                <option value="Tidak">Tidak</option>
                            </select>
                        </div>
                        <div class="col-4">
                            <label>Guru Senior</label>
                            <input type="number" id="guruSenior" class="form-control form-control-sm" value="0">
                        </div>
                    </div>

                    <label>Jenis Konsumsi & Alat</label>
                    <input type="text" id="jenisKonsumsi" class="form-control form-control-sm" placeholder="Snack + Gelas" required>

                    <label>Keterangan</label>
                    <textarea id="keterangan" class="form-control form-control-sm" rows="2"></textarea>

                    <button type="submit" id="btnKirim" class="btn btn-submit w-100 mt-3 btn-sm shadow">SIMPAN RENCANA</button>
                </form>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="card table-card overflow-hidden">
                <div class="bg-dark p-2"><h6 class="text-white mb-0 text-center">REKAP PEMETAAN KEGIATAN</h6></div>
                <div class="table-responsive">
                    <table class="table table-sm table-hover mb-0">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Tahap</th>
                                <th>Kegiatan</th>
                                <th>Tgl/Waktu</th>
                                <th>Peserta</th>
                                <th>Konsumsi</th>
                                <th>Keterangan</th>
                            </tr>
                        </thead>
                        <tbody id="rekapTable">
                            <tr><td colspan="7" class="text-center py-4">Memuat data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // GANTI DENGAN URL APPS SCRIPT SPREADSHEET PEMETAAN ANDA
    const SCRIPT_URL = "URL_WEB_APP_PEMETAAN_ANDA"; 

    function loadRekap() {
        fetch(SCRIPT_URL)
            .then(res => res.json())
            .then(data => {
                let html = "";
                if (data && data.length > 1) {
                    for(let i = 1; i < data.length; i++) {
                        html += `<tr>
                            <td>${i}</td>
                            <td><span class="badge ${data[i][1] == 'Before' ? 'bg-info' : data[i][1] == 'During' ? 'bg-success' : 'bg-secondary'}">${data[i][1]}</span></td>
                            <td><b>${data[i][2]}</b><br><small class="text-muted">${data[i][3]} - ${data[i][6]}</small></td>
                            <td>${data[i][4]}<br><small>${data[i][5]}</small></td>
                            <td>${data[i][7]} <small>Orang</small></td>
                            <td>${data[i][10]}</td>
                            <td><small>${data[i][12] || '-'}</small></td>
                        </tr>`;
                    }
                    document.getElementById('rekapTable').innerHTML = html;
                } else {
                    document.getElementById('rekapTable').innerHTML = '<tr><td colspan="7" class="text-center">Belum ada rencana.</td></tr>';
                }
            });
    }

    document.getElementById('formPemetaan').onsubmit = function(e) {
        e.preventDefault();
        const btn = document.getElementById('btnKirim');
        btn.disabled = true;
        btn.innerText = "MENYIMPAN...";

        const data = {
            tahapan: document.getElementById('tahapan').value,
            namaKegiatan: document.getElementById('namaKegiatan').value,
            jenisKegiatan: document.getElementById('jenisKegiatan').value,
            tanggal: document.getElementById('tanggal').value,
            waktu: document.getElementById('waktu').value,
            tempat: document.getElementById('tempat').value,
            peserta: document.getElementById('peserta').value,
            pimpinan: document.getElementById('pimpinan').value,
            guruSenior: document.getElementById('guruSenior').value,
            jenisKonsumsi: document.getElementById('jenisKonsumsi').value,
            kebutuhan: "", // Kolom Kebutuhan digabung di UI
            keterangan: document.getElementById('keterangan').value
        };

        fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) })
        .then(() => {
            alert('Rencana Berhasil Disimpan!');
            location.reload();
        });
    };

    loadRekap();
</script>
</body>
</html>
