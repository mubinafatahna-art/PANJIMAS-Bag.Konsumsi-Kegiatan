<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPK - Pemetaan Konsumsi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-size: 0.85rem; }
        .header-box { background: #1e293b; color: white; border-radius: 12px; }
        .card { border: none; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        label { font-weight: bold; font-size: 0.75rem; color: #334155; margin-top: 12px; display: block; }
        .form-control-sm { border-radius: 8px; padding: 8px; border: 1px solid #cbd5e1; }
        .btn-save { background: #1e293b; color: white; font-weight: bold; border-radius: 8px; transition: 0.3s; }
        .btn-save:hover { background: #334155; color: white; }
    </style>
</head>
<body class="p-2 p-md-4">

<div class="container-fluid">
    <div class="header-box p-3 text-center mb-4">
        <h3 class="fw-bold mb-0">SISTEM PEMETAAN KEGIATAN (SPK)</h3>
        <p class="mb-0 small text-uppercase tracking-wider">PEMETAAN KONSUMSI KEGIATAN PANJIMAS 2026</p>
    </div>

    <div class="row g-4">
        <div class="col-lg-4">
            <div class="card p-3">
                <h6 class="fw-bold border-bottom pb-2 mb-3">FORM PERENCANAAN</h6>
                <form id="formPemetaan">
                    <label>Tahapan (Before/During/After)</label>
                    <select id="tahapan" class="form-control form-control-sm" required>
                        <option value="Before">Before (Persiapan)</option>
                        <option value="During">During (Pelaksanaan)</option>
                        <option value="After">After (Pasca Kegiatan)</option>
                    </select>

                    <label>Nama Kegiatan</label>
                    <input type="text" id="namaKegiatan" class="form-control form-control-sm" placeholder="Contoh: Rapat Pleno" required>

                    <label>Jenis Kegiatan</label>
                    <select id="jenisKegiatan" class="form-control form-control-sm" required>
                        <option value="Rapat/Kumpul">Rapat / Kumpul</option>
                        <option value="Penyambutan Tamu/Walsan">Penyambutan Tamu / Pengarahan Walsan</option>
                        <option value="Ujian">Ujian</option>
                        <option value="Sidang">Sidang</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>

                    <label>Tanggal & Waktu</label>
                    <div class="d-flex gap-2">
                        <input type="date" id="tanggal" class="form-control form-control-sm w-100" required>
                        <input type="time" id="waktu" class="form-control form-control-sm w-100" required>
                    </div>
                    <label>Tempat Kegiatan</label>
                    <input type="text" id="tempat" class="form-control form-control-sm" placeholder="Contoh: Aula Depan" required>

                    <label>Jumlah Peserta (Orang)</label>
                    <input type="number" id="peserta" class="form-control form-control-sm" placeholder="0" required>

                    <label>kehadiran Pimpinan</label>
                    <select id="pimpinan" class="form-control form-control-sm">
                        <option value="Hadir">Hadir</option>
                        <option value="Tidak">Tidak Hadir</option>
                    </select>

                    <label>Jumlah Guru Senior (Orang)</label>
                    <input type="number" id="guruSr" class="form-control form-control-sm" placeholder="0">

                    <div class="bg-light p-3 mt-3 rounded-3 border">
                        <label class="text-primary mt-0 mb-2">DETAIL JENIS KONSUMSI</label>
                        <input type="text" id="kBrat" class="form-control form-control-sm mb-2" placeholder="Konsumsi Berat (Nasi Box/Prasmanan)">
                        <input type="text" id="kRingan" class="form-control form-control-sm mb-2" placeholder="Konsumsi Ringan (Snack Box)">
                        <input type="text" id="kMix" class="form-control form-control-sm" placeholder="Konsumsi Berat & Ringan">
                    </div>

                    <label>Kebutuhan Alat</label>
                    <input type="text" id="alat" class="form-control form-control-sm" placeholder="Contoh: Piring, Gelas, Taplak">

                    <label>Keterangan Tambahan</label>
                    <textarea id="ket" class="form-control form-control-sm" rows="3" placeholder="Catatan penting lainnya..."></textarea>

                    <button type="submit" id="btn" class="btn btn-save w-100 mt-4 shadow-sm py-2">SIMPAN RENCANA</button>
                </form>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="card overflow-hidden">
                <div class="bg-dark p-2 text-white text-center small fw-bold">DAFTAR PEMETAAN KEGIATAN</div>
                <div class="table-responsive">
                    <table class="table table-sm table-hover align-middle mb-0" style="font-size: 0.75rem;">
                        <thead class="table-light text-uppercase">
                            <tr>
                                <th class="ps-3">No</th>
                                <th>Tahap / Jenis</th>
                                <th>Kegiatan</th>
                                <th>Detail Peserta</th>
                                <th>Konsumsi</th>
                                <th>Alat & Ket</th>
                            </tr>
                        </thead>
                        <tbody id="rekap">
                            <tr><td colspan="6" class="text-center py-5 text-muted">Memuat data dari database...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // GANTI DENGAN URL WEB APP DARI SPREADSHEET PEMETAAN BARU ANDA
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxvndH0xmUd5PDMn2Rnqt1Yel2uTEpwoe1zeB33fWEjIxdf1y2YDtyfzhvdvS_kltj-/exec";

    function loadData() {
        fetch(SCRIPT_URL).then(r => r.json()).then(d => {
            let h = "";
            for(let i=1; i<d.length; i++) {
                h += `<tr>
                    <td class="ps-3 text-muted">${i}</td>
                    <td><span class="badge ${d[i][1]=='Before'?'bg-info':'bg-success'} mb-1">${d[i][1]}</span><br><small class="text-secondary">${d[i][3]}</small></td>
                    <td><strong class="text-dark">${d[i][2]}</strong><br><small class="text-muted">${d[i][4]} | ${d[i][5]}</small></td>
                    <td><b>${d[i][2]}</b><br><small>${d[i][4]} | ${d[i][5]} | Lokasi: ${d[i][6]}</small></td>
                    <td>
                        <small>Peserta: ${d[i][7]}</small><br>
                        <small>Pimp: ${d[i][8]}</small><br>
                        <small>Sr: ${d[i][9]}</small>
                    </td>
                    <td>
                        ${d[i][10] ? '<small>• Berat: '+d[i][10]+'</small><br>' : ''}
                        ${d[i][11] ? '<small>• Snack: '+d[i][11]+'</small><br>' : ''}
                        ${d[i][12] ? '<small>• Mix: '+d[i][12]+'</small>' : ''}
                    </td>
                    <td style="max-width: 150px; white-space: normal;">
                        <small><b>Alat:</b> ${d[i][13] || '-'}</small><br>
                        <small><b>Ket:</b> ${d[i][14] || '-'}</small>
                    </td>
                </tr>`;
            }
            document.getElementById('rekap').innerHTML = h;
        });
    }

    document.getElementById('formPemetaan').onsubmit = function(e) {
        e.preventDefault();
        const btn = document.getElementById('btn');
        btn.disabled = true;
        btn.innerText = "MENYIMPAN...";

        const data = {
            tahapan: document.getElementById('tahapan').value,
            namaKegiatan: document.getElementById('namaKegiatan').value,
            jenisKegiatan: document.getElementById('jenisKegiatan').value,
            tanggal: document.getElementById('tanggal').value,
            waktu: document.getElementById('waktu').value,
            tempat: document.getElementById('tempat').value,
            peserta: document.getElementById('peserta').value,
            pimpinan: document.getElementById('pimpinan').value,
            guruSenior: document.getElementById('guruSenior').value,
            konsumsiBerat: document.getElementById('kBrat').value,
            konsumsiRingan: document.getElementById('kRingan').value,
            konsumsiMix: document.getElementById('kMix').value,
            kebutuhan: document.getElementById('alat').value,
            keterangan: document.getElementById('ket').value
        };

        fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) })
        .then(() => {
            alert("Rencana Kegiatan Berhasil Disimpan!");
            location.reload();
        });
    };
    loadData();
</script>
</body>
</html>
